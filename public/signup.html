<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fascinate+Inline&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bungee+Tint&family=Oswald:wght@200..700&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/e943f317aa.js" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="index.css">
    <style>
      body{
        padding: 0 8%;
        overflow-x: hidden;
        font-family: "Poppins", sans-serif;
        font-style: normal;
      }
    </style>
</head>
<body>
    <div class="d-flex justify-content-between align-items-center my-4 top-login-section">
      <div class="left-login-side">
        <h2 class="logo-login">livest</h2>
      </div>
      <div class="menu-side" style="font-size: 25px; display: none;">
        <i id="hamburgerIcon" style="cursor: pointer; margin-right: 10px;" class="fa-solid fa-bars"></i>
        <i id="accountIcon" class="fa-solid fa-right-from-bracket"></i>
      </div>
      <div class="center-login-side">
        <div class="" style="font-size: 25px;">
          <i id="closeIcon" style="cursor: pointer; margin-bottom: 20px;" class="fa-solid fa-xmark"></i>
        </div>
        <a href="">Home</a>
        <a href="">Property</a>
        <a href="">Loan <i class="fa-solid fa-caret-down"></i></a>
        <a href="">About</a>
        <a href="">Contact</a>
      </div>
      <div class="right-login-side" id="loggedCheck">
        <i id="closeIcon2" style="cursor: pointer; margin-bottom: 20px;" class="fa-solid fa-xmark"></i>
        <div class="accountlog">
          <a href="login.html">Login in</a>
          <a data-bs-toggle="modal" data-bs-target="#staticBackdrop" href="">Join Now</a>
        </div>
      </div>
    </div>

    <div class="loginTitle d-flex flex-column justify-content-center align-items-center my-5">
      <div class="forBreadcumb bg-light rounded-5">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="index.html">Home</a></li>
            <li class="breadcrumb-item active" aria-current="page">Sign up</li>
          </ol>
        </nav>
      </div>
      <h1>Sign Up & grow your wealth</h1>
    </div>

    <div class="loginForm">
      <div class="row formRow align-items-center">
        <!-- col-md 1 -->
        <div class="col-md-6">
          <!-- start of form -->
          <div class="p-4 rounded-5 bg-light">
            <h3 class="mb-4">Sign up now</h3>
            <div class="nameInput mb-3">
              <label class="form-label" for="userFname">First Name</label>
              <div class="input-group">
                <span class="input-group-text"><i class="fa-solid fa-user"></i></span>
                <input type="text" id="userFname" class="p-2 form-control" placeholder="Enter your firstname">
              </div>  
              <div id="InvalidText"></div>
            </div>
            <div class="nameInput mb-3">
              <label class="form-label" for="userLname">Last Name</label>
              <div class="input-group">
                <span class="input-group-text"><i class="fa-solid fa-user"></i></span>
                <input type="text" id="userLname" class="p-2 form-control" placeholder="Enter your lastname">
              </div>  
              <div id="InvalidText2"></div>
            </div>
            <div class="emailInput mb-3">
              <label class="form-label" for="email">Email Address</label>
              <div class="input-group">
                <span class="input-group-text"><i class="fa-solid fa-envelope"></i></span>
                <input type="email" id="userEmail" class="p-2 form-control" placeholder="Enter your email">
              </div>  
              <p id="InvalidText3"></p>
            </div>
            <div class="passwordInput mb-3">
              <label class="form-label" for="password">Password</label>
              <div class="input-group">
                <span class="input-group-text"><i class="fa-solid fa-lock"></i></span>
                <input type="password" id="userPassword" class="p-2 form-control" placeholder="Enter your Password">
              </div>  
              <p id="InvalidText4"></p>
            </div>
            <div class="remember-forgot d-flex justify-content-between align-items-center">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault">
                <label class="form-check-label" for="flexCheckDefault">
                    I agree with the rules
                </label>
              </div>
              <p><a class="forgot" href="">Forgot Password?</a></p>
            </div>
            <div id="InvalidText5"></div>
            <button id="signUp" type="button" class="btn btn-login w-100 py-2 text-white my-4 text-center">Sign up</button>
            <div class="loginWith d-flex justify-content-between align-items-center">
              <div></div>
              <p>Already have an account? <a href="login.html">Sign in</a></p>
              <div></div>
            </div>
            <div class="goApp d-flex text-center align-items-center justify-content-between">
              <button id="signGoogle" class="d-flex justify-content-center align-items-center w-50 btn"><img width="20" height="20" src="https://img.icons8.com/color/48/google-logo.png" alt="google-logo"/><span>Google</span></button>
              <button class="d-flex justify-content-center align-items-center w-50 btn w-50"><i class="fa-brands fa-apple"></i><span>Apple</span></button>
            </div>
          </div>
          <!-- end of form -->
        </div>
        <div style="height: 700px;" class="col-md-6 imgSide">
        
        </div>
      </div>
    </div>


<!-- Modal -->
<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content py-3 px-4">
      <div class="modal-header">
        <h1></h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="top-text text-center my-3">
        <h3>Welcome to Livest</h3>
        <p>Our platform seamlessly connects real estate agents and 
          property owners with serious buyers, making transactions faster, easier, and more efficient. Sign up today to
          list, discover, and close deals effortlessly!
        </p>
      </div>
      <h6>Register</h6>
      <div class="goApp mt-3 d-flex text-center align-items-center justify-content-between">
        <button class="d-flex justify-content-center align-items-center w-50 btn"><img width="20" height="20" src="https://img.icons8.com/color/48/google-logo.png" alt="google-logo"/><span>Google</span></button>
        <button class="d-flex justify-content-center align-items-center w-50 btn w-50"><i class="fa-brands fa-apple"></i><span>Apple</span></button>
      </div>
      <button class="btn btn-login w-100 py-2 text-white my-4 text-center">Register via Email and Password</button>
      <p class="text-center">Already have an account <a href="login.html">Sign in</a></p>
      <small class="text-center">By continuing you agree to the Policy and Rules</small>
    </div>
  </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
   
    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-app.js";
      import { getAuth, updateProfile, onAuthStateChanged, signOut, createUserWithEmailAndPassword, signInWithPopup, GoogleAuthProvider, signInWithRedirect, sendEmailVerification } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-auth.js";
      import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-database.js";
      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries
    
      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyASp595xhwD3gYSm_CfzivBe5hE0MtnA_o",
        authDomain: "livest-real-estate.firebaseapp.com",
        databaseURL: "https://livest-real-estate-default-rtdb.firebaseio.com",
        projectId: "livest-real-estate",
        storageBucket: "livest-real-estate.firebasestorage.app",
        messagingSenderId: "647434805745",
        appId: "1:647434805745:web:610c262a9968a1a6ac2450"
      };
    
      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const database = getDatabase(app)
      const provider = new GoogleAuthProvider();
      let loggedCheck = document.getElementById('loggedCheck')
      let signGoogle = document.getElementById('signGoogle')
      let accountlog = document.querySelector('.accountlog')
      signGoogle.addEventListener('click', ()=>{
        signInWithPopup (auth, provider)
          .then((userCredential)=>{
            // The signed-in user info.
            const user = userCredential.user;
            console.log(user.email);
            if(user){
                window.location.href="index.html"
            }
          }).catch((error) => {
              // Handle Errors here.
              const errorCode = error.code;
              const errorMessage = error.message;
              // The email of the user's account used.
              const email = error.customData.email;
              // The AuthCredential type that was used.
              const credential = GoogleAuthProvider.credentialFromError(error);
              // ...
              console.log(errorCode);
              console.log(errorMessage);
              console.log(email);
              
              console.log(credential); 
            });
        })
      onAuthStateChanged(auth, (user) => {
        if (user) {
            // User is signed in
            accountlog.style.display="none"
            loggedCheck.innerHTML = `<img style="width: 50px; height: 50px; border-radius: 50%;" src="${user.photoURL}">`
            location.href='index.html'
            if (!user.emailVerified) {
              alert("Please verify your email before logging in.");
              signOut(auth);
              return;
            }
        } else {
            // No user is signed in
            console.log("User is not log in.");
        }
      });
      accountlog.firstElementChild.classList.add('login')
      accountlog.lastElementChild.classList.add('sign')

        let userFname = document.getElementById('userFname')
        let userLname = document.getElementById('userLname')
        let userEmail = document.getElementById('userEmail')
        let userPassword = document.getElementById('userPassword')
        let trimmedFName, trimmedLName, trimmedEmail, trimmedPassword;
        userFname.addEventListener('keyup', ()=>{
            let invalidText= document.getElementById('InvalidText')
            trimmedFName = userFname.value.trim()
            if(trimmedFName.length < 3){
                invalidText.innerHTML=`<small class="text-danger">First Name cannot be less than 3</small>`
            }else{
                invalidText.innerHTML =`<small class="text-primary">First Name is valid</small>`
            }
        })
        userLname.addEventListener('keyup', ()=>{
            trimmedLName = userLname.value.trim()
            let invalidText2= document.getElementById('InvalidText2')
            if(trimmedLName.length < 3){
                invalidText2.innerHTML=`<small class="text-danger">Last Name cannot be less than 3</small>`
                // alert("invalidText1")
            }else{
                invalidText2.innerHTML =`<small class="text-primary">Last Name is valid</small>`
            }
        })
        function isValidEmail(email) {
          return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }
        userEmail.addEventListener('keyup', ()=>{
            trimmedEmail = userEmail.value.trim()
            let invalidText3= document.getElementById('InvalidText3')
            if(!isValidEmail(trimmedEmail)){
              InvalidText3.innerHTML = `<small class="text-danger">Invalid email format</small>`;
                // alert("invalidText1")
            }else{
                invalidText3.innerHTML =`<small class="text-primary">Email is valid</small>`
            }
        })
        userPassword.addEventListener('keyup', ()=>{
            trimmedPassword = userPassword.value.trim()
            let invalidText4= document.getElementById('InvalidText4')
            if(trimmedPassword.length < 8){
                invalidText4.innerHTML=`<small class="text-danger">Password must be at least 8 characters</small>`
            }else{
                invalidText4.innerHTML =`<small class="text-primary">Strong Password</small>`
            }
        })
        let signUp = document.getElementById('signUp')
        let flexCheckDefault = document.getElementById('flexCheckDefault')
        signUp.addEventListener('click', ()=>{
            if(userFname.value!="" && userLname.value!="" && isValidEmail(trimmedEmail) && userPassword.value!=""){
              let trimmedFName = userFname.value.trim();
              let trimmedLName = userLname.value.trim();
              let trimmedEmail = userEmail.value.trim();
              let trimmedPassword = userPassword.value.trim();  
                if(flexCheckDefault.checked){
                  createUserWithEmailAndPassword(auth, trimmedEmail, trimmedPassword)
                  .then((userCredential) => {
                    alert("Sign up successful")
                    const user = auth.currentUser;
                    sendEmailVerification(auth.currentUser)
                    .then(() => {
                      alert('email sent')
                    }).catch((err)=>{
                      alert(err)
                    });
                    updateProfile(user, {
                      displayName: `${trimmedFName} ${trimmedLName}`
                    }).then(() => {
                      let userDetails = {
                        userFname: trimmedFName,
                        userLname: trimmedLName,
                        userEmail: trimmedEmail,
                        createdAt: new Date().toISOString()
                      };
                      const userRef = ref(database, `/Registered-User/${user.uid}`)
                      set(userRef, userDetails)
                      .then(()=>{
                        alert('info saved')
                        location.href = "login.html"
                      }).catch((err)=>{
                        console.log('info not save',err);
                      })
                    });
                    signOut(auth).then(() => {
                      // Sign-out successful.
                    }).catch((error) => {
                      // An error happened.
                    });
                  })
                  .catch((error) => {
                    const errorCode = error.code;
                    const errorMessage = error.message;
                    if (error.code === "auth/email-already-in-use") {
                        InvalidText5.innerHTML = `<small class="text-danger">This email is already registered. <a href="login.html">Login instead?</a></small>`;
                    } else {
                        alert("Error: " + error.message);
                    }
                  });
                }else{
                  InvalidText5.innerHTML = `<small class="text-danger">make sure you click on "i agree with rules"</small>`
                }
                
            }else{
                InvalidText5.innerHTML=`<small class="text-danger">Please fill in all required fields</small>`
            }
      })

      let hamburgerIcon = document.getElementById('hamburgerIcon')
      let accountIcon = document.getElementById('accountIcon')
      let closeIcon = document.getElementById('closeIcon')
      let centerSide = document.querySelector('.center-login-side')
      let rightSide = document.querySelector('.right-login-side')
    hamburgerIcon.addEventListener('click', ()=>{
      centerSide.classList.toggle('showMenu')
    })
    closeIcon.addEventListener('click', (e)=>{
      e.preventDefault()
      if(centerSide.classList.contains('showMenu')){
        centerSide.classList.remove('showMenu')
      }
    })
    accountIcon.addEventListener('click', ()=>{
      rightSide.classList.add('showAccout')
    })
    closeIcon2.addEventListener('click', (e)=>{
      e.preventDefault()
      if(rightSide.classList.contains('showAccout')){
        rightSide.classList.remove('showAccout')
      }
    })
    document.addEventListener('click', (e)=>{
      if(centerSide.classList.contains('showMenu') && !centerSide.contains(e.target) && !hamburgerIcon.contains(e.target)){
        centerSide.classList.remove('showMenu')
      }
      else if(rightSide.classList.contains('showAccout') && !rightSide.contains(e.target) && !accountIcon.contains(e.target)){
        rightSide.classList.remove('showAccout')
      }
    })
    </script>
</body>
</html>