<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/public/bootstrap-5.3.3-dist/css/bootstrap.css">
</head>
<body>
    <div class="shadow rounded p-5 mx-4 bg-white">
        <h4 class="mb-5">Personal Details</h4>
        <form class="row g-3">
            <div class="mb-3 d-flex gap-3 align-items-center">
                <!-- <img style="width: 70px; height: 70px; border-radius: 50%; border: 1px solid darkblue;" src="" alt=""> -->
                <input type="file" id="fileInput" accept="image/*" />
                <img id="imagePreview" src="" alt="Preview" style="max-width: 150px; display: block; margin-top: 10px;" />

              </div>
            <div class="col-md-3">
              <label for="inputEmail4" class="form-label">Surname</label>
              <input type="text" class="form-control" id="surname">
            </div>
            <div class="col-md-3">
              <label for="inputPassword4" class="form-label">Firstname</label>
              <input type="text" class="form-control" id="firstname">
            </div>
            <div class="col-md-3">
              <label for="inputPassword4" class="form-label">Middlename</label>
              <input type="text" class="form-control" id="middlename">
            </div>
            <div class="col-md-3">
                <label for="inputState" class="form-label">Gender</label>
                <select id="gender" class="form-select">
                  <option selected>Choose...</option>
                  <option value="male">Male</option>
                  <option value="female">Female</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="inputState" class="form-label">Marital Status</label>
                <select id="maritalStatus" class="form-select">
                  <option selected>Choose...</option>
                  <option value="single">Single</option>
                  <option value="married">Married</option>
                  <option value="divorced">Divorced</option>
                  <option value="widow">Widow/widower</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="inputPassword4" class="form-label">Date of birth</label>
                <input type="date" class="form-control" id="dob">
            </div>
            <div class="col-md-3">
                <label for="inputState" class="form-label">Country</label>
                <select id="country" class="form-select">
                  <option selected>Choose...</option>
                  <option value="">-- Select a country --</option>
                    <option value="Afghanistan">Afghanistan</option>
                    <option value="Albania">Albania</option>
                    <option value="Algeria">Algeria</option>
                    <option value="Andorra">Andorra</option>
                    <option value="Angola">Angola</option>
                    <option value="Antigua and Barbuda">Antigua and Barbuda</option>
                    <option value="Argentina">Argentina</option>
                    <option value="Armenia">Armenia</option>
                    <option value="Australia">Australia</option>
                    <option value="Austria">Austria</option>
                    <option value="Azerbaijan">Azerbaijan</option>
                    <option value="Bahamas">Bahamas</option>
                    <option value="Bahrain">Bahrain</option>
                    <option value="Bangladesh">Bangladesh</option>
                    <option value="Barbados">Barbados</option>
                    <option value="Belarus">Belarus</option>
                    <option value="Belgium">Belgium</option>
                    <option value="Belize">Belize</option>
                    <option value="Benin">Benin</option>
                    <option value="Bhutan">Bhutan</option>
                    <option value="Bolivia">Bolivia</option>
                    <option value="Bosnia and Herzegovina">Bosnia and Herzegovina</option>
                    <option value="Botswana">Botswana</option>
                    <option value="Brazil">Brazil</option>
                    <option value="Brunei">Brunei</option>
                    <option value="Bulgaria">Bulgaria</option>
                    <option value="Burkina Faso">Burkina Faso</option>
                    <option value="Burundi">Burundi</option>
                    <option value="Cabo Verde">Cabo Verde</option>
                    <option value="Cambodia">Cambodia</option>
                    <option value="Cameroon">Cameroon</option>
                    <option value="Canada">Canada</option>
                    <option value="Central African Republic">Central African Republic</option>
                    <option value="Chad">Chad</option>
                    <option value="Chile">Chile</option>
                    <option value="China">China</option>
                    <option value="Colombia">Colombia</option>
                    <option value="Comoros">Comoros</option>
                    <option value="Congo (Congo-Brazzaville)">Congo (Congo-Brazzaville)</option>
                    <option value="Costa Rica">Costa Rica</option>
                    <option value="Croatia">Croatia</option>
                    <option value="Cuba">Cuba</option>
                    <option value="Cyprus">Cyprus</option>
                    <option value="Czech Republic">Czech Republic</option>
                    <option value="Democratic Republic of the Congo">Democratic Republic of the Congo</option>
                    <option value="Denmark">Denmark</option>
                    <option value="Djibouti">Djibouti</option>
                    <option value="Dominica">Dominica</option>
                    <option value="Dominican Republic">Dominican Republic</option>
                    <option value="Ecuador">Ecuador</option>
                    <option value="Egypt">Egypt</option>
                    <option value="El Salvador">El Salvador</option>
                    <option value="Equatorial Guinea">Equatorial Guinea</option>
                    <option value="Eritrea">Eritrea</option>
                    <option value="Estonia">Estonia</option>
                    <option value="Eswatini">Eswatini</option>
                    <option value="Ethiopia">Ethiopia</option>
                    <option value="Fiji">Fiji</option>
                    <option value="Finland">Finland</option>
                    <option value="France">France</option>
                    <option value="Gabon">Gabon</option>
                    <option value="Gambia">Gambia</option>
                    <option value="Georgia">Georgia</option>
                    <option value="Germany">Germany</option>
                    <option value="Ghana">Ghana</option>
                    <option value="Greece">Greece</option>
                    <option value="Grenada">Grenada</option>
                    <option value="Guatemala">Guatemala</option>
                    <option value="Guinea">Guinea</option>
                    <option value="Guinea-Bissau">Guinea-Bissau</option>
                    <option value="Guyana">Guyana</option>
                    <option value="Haiti">Haiti</option>
                    <option value="Honduras">Honduras</option>
                    <option value="Hungary">Hungary</option>
                    <option value="Iceland">Iceland</option>
                    <option value="India">India</option>
                    <option value="Indonesia">Indonesia</option>
                    <option value="Iran">Iran</option>
                    <option value="Iraq">Iraq</option>
                    <option value="Ireland">Ireland</option>
                    <option value="Israel">Israel</option>
                    <option value="Italy">Italy</option>
                    <option value="Ivory Coast">Ivory Coast</option>
                    <option value="Jamaica">Jamaica</option>
                    <option value="Japan">Japan</option>
                    <option value="Jordan">Jordan</option>
                    <option value="Kazakhstan">Kazakhstan</option>
                    <option value="Kenya">Kenya</option>
                    <option value="Kiribati">Kiribati</option>
                    <option value="Kuwait">Kuwait</option>
                    <option value="Kyrgyzstan">Kyrgyzstan</option>
                    <option value="Laos">Laos</option>
                    <option value="Latvia">Latvia</option>
                    <option value="Lebanon">Lebanon</option>
                    <option value="Lesotho">Lesotho</option>
                    <option value="Liberia">Liberia</option>
                    <option value="Libya">Libya</option>
                    <option value="Liechtenstein">Liechtenstein</option>
                    <option value="Lithuania">Lithuania</option>
                    <option value="Luxembourg">Luxembourg</option>
                    <option value="Madagascar">Madagascar</option>
                    <option value="Malawi">Malawi</option>
                    <option value="Malaysia">Malaysia</option>
                    <option value="Maldives">Maldives</option>
                    <option value="Mali">Mali</option>
                    <option value="Malta">Malta</option>
                    <option value="Marshall Islands">Marshall Islands</option>
                    <option value="Mauritania">Mauritania</option>
                    <option value="Mauritius">Mauritius</option>
                    <option value="Mexico">Mexico</option>
                    <option value="Micronesia">Micronesia</option>
                    <option value="Moldova">Moldova</option>
                    <option value="Monaco">Monaco</option>
                    <option value="Mongolia">Mongolia</option>
                    <option value="Montenegro">Montenegro</option>
                    <option value="Morocco">Morocco</option>
                    <option value="Mozambique">Mozambique</option>
                    <option value="Myanmar">Myanmar</option>
                    <option value="Namibia">Namibia</option>
                    <option value="Nauru">Nauru</option>
                    <option value="Nepal">Nepal</option>
                    <option value="Netherlands">Netherlands</option>
                    <option value="New Zealand">New Zealand</option>
                    <option value="Nicaragua">Nicaragua</option>
                    <option value="Niger">Niger</option>
                    <option value="Nigeria">Nigeria</option>
                    <option value="North Korea">North Korea</option>
                    <option value="North Macedonia">North Macedonia</option>
                    <option value="Norway">Norway</option>
                    <option value="Oman">Oman</option>
                    <option value="Pakistan">Pakistan</option>
                    <option value="Palau">Palau</option>
                    <option value="Palestine State">Palestine State</option>
                    <option value="Panama">Panama</option>
                    <option value="Papua New Guinea">Papua New Guinea</option>
                    <option value="Paraguay">Paraguay</option>
                    <option value="Peru">Peru</option>
                    <option value="Philippines">Philippines</option>
                    <option value="Poland">Poland</option>
                    <option value="Portugal">Portugal</option>
                    <option value="Qatar">Qatar</option>
                    <option value="Romania">Romania</option>
                    <option value="Russia">Russia</option>
                    <option value="Rwanda">Rwanda</option>
                    <option value="Saint Kitts and Nevis">Saint Kitts and Nevis</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="inputState" class="form-label">State of Origin</label>
                <select id="stateOrigin" class="form-select">
                  <option selected>Choose...</option>
                </select>
            </div>
            <h6 class="mt-5">Contact</h6>
            <div class="col-md-3">
              <label for="inputAddress" class="form-label">Phone Number</label>
              <input type="text" class="form-control" id="phoneNumber">
            </div>
            <div class="col-md-3">
              <label for="inputAddress" class="form-label">Phone Number 2</label>
              <input type="text" class="form-control" id="phoneNumber2">
            </div>
            <div class="col-6">
              <label for="inputAddress2" class="form-label">Email</label>
              <input type="email" class="form-control" id="email">
            </div>
            <div class="col-12">
              <label for="inputAddress2" class="form-label">Address</label>
              <input type="text" class="form-control" id="houseAddress" placeholder="Apartment, studio, or floor">
            </div>
            <h6 class="mt-5">Business Information</h6>
            <div class="col-md-3">
              <label for="inputCity" class="form-label">Business name</label>
              <input type="text" class="form-control" id="businessName">
            </div>
            
            <div class="col-md-3">
              <label for="inputZip" class="form-label">Phone Number</label>
              <input type="text" class="form-control" id="businessNumber">
            </div>
            <div class="col-md-6">
              <label for="inputZip" class="form-label">Email</label>
              <input type="text" class="form-control" id="businessEmail">
            </div>
            <div class="col-12">
              <button id="saveInfo" type="button" class="btn btn-primary">Save</button>
            </div>
          </form>
    </div>



    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-app.js";
      import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-auth.js";
      import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-database.js";
      import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-storage.js";
      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries
    
      // Your web app's Firebase configuration
      const firebaseConfig = {
          apiKey: "AIzaSyASp595xhwD3gYSm_CfzivBe5hE0MtnA_o",
          authDomain: "livest-real-estate.firebaseapp.com",
          databaseURL: "https://livest-real-estate-default-rtdb.firebaseio.com",
          projectId: "livest-real-estate",
          storageBucket: "livest-real-estate.firebasestorage.app",
          messagingSenderId: "647434805745",
          appId: "1:647434805745:web:610c262a9968a1a6ac2450"
      };
    
      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const database = getDatabase()
      const storage = getStorage(app);
      let surname = document.getElementById('surname')
      let firstname = document.getElementById('firstname')
      let middlename = document.getElementById('middlename')
      let email = document.getElementById('email')
      let dob = document.getElementById('dob')
      let gender = document.getElementById('gender')
      let maritalStatus = document.getElementById('maritalStatus')
      let country = document.getElementById('country')
      let stateOrigin = document.getElementById('stateOrigin')
      let houseAddress = document.getElementById('houseAddress')
      let businessName = document.getElementById('businessName')
      let businessEmail= document.getElementById('businessEmail')
      let businessNumber = document.getElementById('businessNumber')
      let saveInfo = document.getElementById('saveInfo')
      
      
      onAuthStateChanged(auth, (user)=>{
        if(user){
          const userRef = ref(database, 'users/' + auth.currentUser.uid); // Assuming you want to save under the user's UID
          const [first, last] = user.displayName.split(' ');
          surname.value = last
          firstname.value = first
          email.value = user.email
          // console.log(email.value);
          
          saveInfo.addEventListener('click', () => {
                const userProfile = {
                  surname: surname.value,
                  firstname: firstname.value,
                  middlename: middlename.value,
                  email: email.value,
                  dob: dob.value,
                  gender: gender.value,
                  maritalStatus: maritalStatus.value,
                  country: country.value,
                  stateOrigin: stateOrigin.value,
                  houseAddress: houseAddress.value,
                  businessName: businessName.value,
                  businessEmail: businessEmail.value,
                  businessNumber: businessNumber.value
                };
                console.log(userProfile);
                set(userRef, userProfile)
                .then(() => {
                  alert("Information saved successfully!");
                })
                .catch((error) => {
                  alert("Error saving information: " + error.message);
                });
          });

          onValue(userRef, (snapshot) => {
          const data = snapshot.val();
            if (data) {
              // Set form values
              surname.value = data.surname || '';
              firstname.value = data.firstname || '';
              middlename.value = data.middlename || '';
              email.value = data.email || '';
              dob.value = data.dob || '';
              gender.value = data.gender || '';
              maritalStatus.value = data.maritalStatus || '';
              country.value = data.country || '';
              stateOrigin.value = data.state || '';
              houseAddress.value = data.houseAddress || '';
              businessName.value = data.businessName || '';
              businessEmail.value = data.businessEmail || '';
              businessNumber.value = data.businessNumber || '';
              imagePreview.src = data.profilePicture || '';
            }
          });
        }
        const fileInput = document.getElementById('fileInput');
        const imagePreview = document.getElementById('imagePreview');


  fileInput.addEventListener('change', (event) => {
    const file = event.target.files[0];
    console.log(fileInput.value);
    if (file && file.type.startsWith('image/')) {
      const filePath = `profile_pictures/${user.uid}/${file.name}`;
      const fileRef = storageRef(storage, filePath);

      uploadBytes(fileRef, file).then((snapshot) => {
        console.log("Image uploaded!");
      
        // Get the download URL
        return getDownloadURL(fileRef);
      }).then((url) =>{
        console.log("Download URL:", url);
        imagePreview.src = url;
        // Save image URL to Realtime Database
        const userRef = ref(database, 'users/' + user.uid);
        set(userRef, {
          surname: surname.value,
          firstname: firstname.value,
          middlename: middlename.value,
          email: email.value,
          dob: dob.value,
          gender: gender.value,
          maritalStatus: maritalStatus.value,
          country: country.value,
          stateOrigin: stateOrigin.value,
          houseAddress: houseAddress.value,
          businessName: businessName.value,
          businessEmail: businessEmail.value,
          businessNumber: businessNumber.value,
          profilePicture: url // Save image URL here
        });
      }).catch((error) =>{
        console.error("Error uploading image:", error);
        alert("Image upload failed: " + error.message);
      })
    }else {
      alert("Please select a valid image file.");
    }
  });
})

      



    </script>
</body>
</html>